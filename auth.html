<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication - The Apothecary Diaries</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/jpg" href="image/logo.jpeg">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'glass-border': 'rgba(255, 255, 255, 0.2)',
                        'glass-bg': 'rgba(255, 255, 255, 0.2)',
                        'theme-orange': '#ffb26b',
                    },
                    boxShadow: {
                        'glass': '0 4px 30px rgba(0, 0, 0, 0.1)',
                        'glow': '0 0 15px rgba(255, 178, 107, 0.3)',
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'Tahoma', 'Geneva', 'Verdana', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .glass {
                @apply backdrop-blur-md bg-glass-bg border border-glass-border shadow-glass rounded-2xl;
            }
            .nav-link {
                @apply text-white font-bold text-lg hover:text-theme-orange transition-colors duration-300;
            }
            .form-input {
                @apply w-full bg-black/20 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:border-theme-orange focus:bg-black/40 transition-all duration-300;
            }
            .auth-btn {
                @apply w-full py-3 bg-white text-theme-orange hover:text-white font-bold rounded-lg hover:bg-theme-orange hover:scale-105 transition-all duration-300 cursor-pointer border-none mt-6 uppercase tracking-wide shadow-lg;
            }
            .tab-btn {
                @apply w-1/2 py-3 text-center cursor-pointer font-bold text-white/50 border-b-2 border-transparent transition-all duration-300 hover:text-white;
            }
            .tab-btn.active {
                @apply text-theme-orange border-theme-orange;
            }
        }
    </style>
</head>

<body class="bg-black font-sans min-h-screen text-white relative">

    <img src="image/apothbgland.png" alt="Background"
        class="fixed inset-0 w-full h-full -z-10 hidden md:block opacity-90 transition-opacity duration-700">
    <img src="image/apothbgport.png" alt="Background"
        class="fixed inset-0 w-full h-full -z-10 block md:hidden opacity-90 transition-opacity duration-700">

    <header class="fixed top-0 w-full z-50 px-4 py-3">
        <nav class="glass flex items-center justify-between px-6 py-3 max-w-7xl h-20 mx-auto">
            <div class="flex items-center gap-8">
                <a href="index.html" class="w-20 h-15 overflow-hidden hover:scale-105 transition-transform">
                    <img src="image/logo1.png" alt="Logo" class="w-full h-full">
                </a>
                <ul class="hidden md:flex gap-8">
                    <li><a href="Anime.html" class="nav-link">Anime</a></li>
                    <li><a href="manga.html" class="nav-link">Manga</a></li>
                    <li><a href="character.html" class="nav-link">Characters</a></li>
                    <li><a href="about.html" class="nav-link">About</a></li>
                </ul>
            </div>

            <div class="flex items-center gap-4">
                <a href="#"
                    class="w-10 h-10 rounded-full overflow-hidden border border-white/50 hover:border-theme-orange transition-colors opacity-50 cursor-default">
                    <img src="image/accicon.png" alt="Account" class="w-full h-full object-cover">
                </a>
                <button id="mobile-menu-btn" class="md:hidden text-white text-3xl focus:outline-none">â‰¡</button>
            </div>
        </nav>

        <div id="mobile-menu"
            class="hidden absolute top-20 right-4 w-48 glass flex-col items-center py-4 space-y-4 md:hidden">
            <a href="Anime.html" class="nav-link text-base">Anime</a>
            <a href="manga.html" class="nav-link text-base">Manga</a>
            <a href="character.html" class="nav-link text-base">Characters</a>
            <a href="about.html" class="nav-link text-base">About</a>
        </div>
    </header>

    <main class="pt-32 pb-20 px-4 flex items-center justify-center min-h-screen">

        <div class="glass w-full max-w-md p-0 overflow-hidden relative">

            <div class="flex border-b border-white/10 bg-black/20">
                <div id="tab-login" class="tab-btn active" onclick="switchTab('login')">Login</div>
                <div id="tab-register" class="tab-btn" onclick="switchTab('register')">Sign Up</div>
            </div>

            <div class="p-8">

                <form id="login-form" class="flex flex-col gap-4 animate-fade-in">
                    <h2 class="text-2xl font-bold text-center mb-2">Welcome Back</h2>

                    <div>
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Email</label>
                        <input type="email" id="login-email" placeholder="you@example.com" class="form-input" required>
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Password</label>
                        <input type="password" id="login-password" placeholder="Your password" class="form-input"
                            required>
                        <i
                            class="fa-solid fa-eye absolute right-4 top-[38px] text-white/50 cursor-pointer hover:text-white toggle-pass"></i>
                    </div>

                    <div class="text-right">
                        <a href="forgot.html" class="text-sm text-theme-orange hover:underline">Forgot Password?</a>
                    </div>

                    <button type="submit" class="auth-btn">Log In</button>
                </form>

                <form id="register-form" class="hidden flex-col gap-4 animate-fade-in">
                    <h2 class="text-2xl font-bold text-center mb-2">Create Account</h2>

                    <div>
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Username</label>
                        <input type="text" id="reg-username" placeholder="Username" class="form-input" required>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Email</label>
                        <input type="email" id="reg-email" placeholder="you@example.com" class="form-input" required>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Phone</label>
                        <input type="tel" id="reg-phone" placeholder="Your phone number" class="form-input" required>
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Password</label>
                        <input type="password" id="reg-password" placeholder="Min 8 chars" class="form-input" required>
                        <i
                            class="fa-solid fa-eye absolute right-4 top-[38px] text-white/50 cursor-pointer hover:text-white toggle-pass"></i>
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-bold text-white/70 mb-1 ml-1">Confirm Password</label>
                        <input type="password" id="reg-confirm" placeholder="Re-enter password" class="form-input"
                            required>
                        <i
                            class="fa-solid fa-eye absolute right-4 top-[38px] text-white/50 cursor-pointer hover:text-white toggle-pass"></i>
                    </div>

                    <button type="submit" class="auth-btn">Sign Up</button>
                </form>

            </div>
        </div>

    </main>

    <footer
        class="py-8 text-center text-white/90 text-sm relative z-10 glass rounded-t-2xl mx-auto w-[95%] max-w-7xl mb-4">
        <p class="font-bold">&copy; 2026 The Apothecary Diaries Project.</p>
        <p class="mt-2 px-4 opacity-80 max-w-2xl mx-auto">
            <strong>Disclaimer:</strong> This website is developed strictly for
            <span class="text-theme-orange">educational and portfolio purposes only</span>.
            We do not own the rights to the anime, characters, or media content.
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        function switchTab(tab) {
            const loginForm = document.getElementById('login-form');
            const regForm = document.getElementById('register-form');
            const loginTab = document.getElementById('tab-login');
            const regTab = document.getElementById('tab-register');

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                loginForm.classList.add('flex');
                regForm.classList.add('hidden');
                regForm.classList.remove('flex');

                loginTab.classList.add('active');
                regTab.classList.remove('active');
            } else {
                loginForm.classList.add('hidden');
                loginForm.classList.remove('flex');
                regForm.classList.remove('hidden');
                regForm.classList.add('flex');

                loginTab.classList.remove('active');
                regTab.classList.add('active');
            }
        }

        document.addEventListener("DOMContentLoaded", () => {

            // --- UI VARIABLES ---
            const mobileBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const togglePassIcons = document.querySelectorAll('.toggle-pass');

            // --- TOAST HELPER ---
            const showToast = (text, type = 'info') => {
                let bg = "#333";
                if (type === 'success') bg = "linear-gradient(to right, #00b09b, #96c93d)";
                if (type === 'error') bg = "linear-gradient(to right, #ff5f6d, #ffc371)";

                Toastify({
                    text: text, duration: 3000, style: { background: bg },
                    gravity: "top", position: "right"
                }).showToast();
            };

            // --- MOBILE MENU ---
            if (mobileBtn && mobileMenu) {
                mobileBtn.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    mobileMenu.classList.toggle('flex');
                });
            }

            // --- PASSWORD  ---
            togglePassIcons.forEach(icon => {
                icon.addEventListener('click', () => {
                    const input = icon.previousElementSibling;
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            });

            // --- LOGIN ---
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const emailInput = document.getElementById('login-email');
                    const passwordInput = document.getElementById('login-password');
                    const btn = loginForm.querySelector('button');
                    const originalText = btn.textContent;

                    const email = emailInput.value.trim();
                    const password = passwordInput.value.trim();

                    btn.textContent = "Logging in...";
                    btn.disabled = true;

                    try {
                        const res = await fetch('/auth/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify({ email, password })
                        });

                        const data = await res.json();

                        if (res.ok) {
                            showToast("Login successful!", "success");
                            setTimeout(() => window.location.href = 'Anime.html', 1000);
                        } else {
                            if (res.status === 404) {
                                showToast("Email not found.", "error");
                                emailInput.focus();
                            }
                            else if (res.status === 401) {
                                showToast("Incorrect password.", "error");
                                password.value = '';
                                passwordInput.focus();
                            }
                            else {
                                showToast(data.message || "Login failed.", "error");
                            }
                        }
                    } catch (err) {
                        console.error(err);
                        showToast("Server connection failed", "error");
                    } finally {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }
                });
            }

            // --- REGISTER ---
            const regForm = document.getElementById('register-form');
            if (regForm) {
                regForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const username = document.getElementById('reg-username').value;
                    const email = document.getElementById('reg-email').value;
                    const phone = document.getElementById('reg-phone').value;
                    const password = document.getElementById('reg-password').value;
                    const confirm = document.getElementById('reg-confirm').value;
                    const btn = regForm.querySelector('button');
                    const originalText = btn.textContent;
                    
                    if (/\s/.test(username)) {
                        showToast("Username cannot contain spaces", "error");
                        return;
                    }

                    if (!/^\d+$/.test(phone)) {
                        showToast("Enter a valid phone number (digits only)", "error");
                        return;
                    }

                    if (password !== confirm) {
                        showToast("Passwords do not match", "error");
                        return;
                    }
                    if (password.length < 8) {
                        showToast("Password must be at least 8 characters", "error");
                        return;
                    }

                    btn.textContent = "Creating account...";
                    btn.disabled = true;

                    try {
                        const res = await fetch('/auth/register', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ username, email, phone, password })
                        });

                        const data = await res.json();

                        if (res.ok) {
                            showToast("Account created! Please log in.", "success");
                            switchTab('login');
                            document.getElementById('login-email').value = email;
                        } else {
                            showToast(data.message || "Registration failed", "error");
                        }
                    } catch (err) {
                        console.error(err);
                        showToast("Server connection failed", "error");
                    } finally {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }
                });
            }

        });
    </script>
</body>

</html>